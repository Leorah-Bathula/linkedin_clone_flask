{% extends "base.html" %}
{% block content %}
<h2>All Posts</h2>
{% for post in posts %}
<div class="post-card">
    <p><strong>{{ post.author.name }}</strong> • {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
    <p>{{ post.content }}</p>
    {% if post.image %}
    <img src="{{ url_for('static', filename='uploads/' ~ post.image) }}" width="200">
    {% endif %}

    <form method="POST" action="{{ url_for('like', post_id=post.id) }}">
        <button type="submit">{{ '❤️ Unlike' if post.id in liked_posts else '♡ Like' }}</button>
        <span>{{ post.likes|length }} likes</span>
    </form>

    {% if post.user_id == current_user.id %}
    <form method="POST" action="{{ url_for('delete', post_id=post.id) }}">
        <button type="submit" onclick="return confirm('Delete this post?')">Delete</button>
    </form>
    <form method="POST" action="{{ url_for('edit', post_id=post.id) }}">
        <input name="new_content" value="{{ post.content }}">
        <button type="submit">Update</button>
    </form>
    {% endif %}
</div>
{% endfor %}
{% endblock %}
